var utility={QueryString:function(){arg1=arguments[0];arg2=arguments[1];if(arguments.length>1&&arg1!=""&&arg2!=""&&arg1!=undefined&&arg2!=undefined){var b=arguments[0].match(new RegExp("[#&]"+arg2+"=([^&]*)(&?)","i"))}else if(arg1!=""&&arg1!=undefined){var b=location.hash.match(new RegExp("[#&]"+arg1+"=([^&]*)(&?)","i"))}return b?b[1]:b},insertArrayAt:function(array,index,arrayToInsert){Array.prototype.splice.apply(array,[index,0].concat(arrayToInsert));return array},htmlEncode2:function(str){var s="";if(str&&str.length==0||typeof str=="undefined")return s;s=str.replace(/\</g,"&lt;");s=s.replace(/\>/g,"&gt;");s=s.replace(/ /g,"&nbsp;");s=s.replace(/\"/g,"&quot;");return s},playEncode:function(str){var s="";if(str&&str.length==0||typeof str=="undefined")return s;s=str.replace(/\</g,"&lt;");s=s.replace(/\>/g,"&gt;");s=s.replace(/ /g,"&nbsp;");return s},SIPHtmlDecode:function(str){var s="";if(str.length==0||typeof str=="undefined")return s;s=str.replace(/&lt;/g,"<");s=s.replace(/&#60;/g,"<");s=s.replace(/&gt;/g,">");s=s.replace(/&#62;/g,">");return s},getMS:function(msec){var sec=msec/1e3,t=sec,m=Math.floor(t/60),s=Math.floor(t%60),ms="";ms+=m>=10?m:"0"+m;ms+=":";ms+=s>=10?s:"0"+s;return ms},isIE:function(ver){var b=document.createElement("b");b.innerHTML="<!--[if IE "+ver+"]><i></i><![endif]-->";return b.getElementsByTagName("i").length===1},detectOS:function(){var sUserAgent=navigator.userAgent;var isWin=navigator.platform=="Win32"||navigator.platform=="Windows"||navigator.platform=="Win64";var isMac=navigator.platform=="Mac68K"||navigator.platform=="MacPPC"||navigator.platform=="Macintosh"||navigator.platform=="MacIntel";if(isMac)return"Mac";var isUnix=navigator.platform=="X11"&&!isWin&&!isMac;if(isUnix)return"Unix";var isLinux=String(navigator.platform).indexOf("Linux")>-1;if(isLinux)return"Linux";if(isWin){return"Windows"}return"other"},getBrowser:function(){var Sys={};var ua=navigator.userAgent.toLowerCase();var s;(s=ua.match(/rv:([\d.]+)\) like gecko/))?Sys={v:s[1],type:"ie"}:(s=ua.match(/msie ([\d.]+)/))?Sys={v:s[1],type:"ie"}:(s=ua.match(/firefox\/([\d.]+)/))?Sys={v:s[1],type:"firefox"}:(s=ua.match(/chrome\/([\d.]+)/))?Sys={v:s[1],type:"chrome"}:(s=ua.match(/opera.([\d.]+)/))?Sys={v:s[1],type:"opera"}:(s=ua.match(/version\/([\d.]+).*safari/))?Sys={v:s[1],type:"safari"}:0;return Sys},read:function(name,key){var cookieValue="";var search=name+"=";if(document.cookie.split("").length>0){offset=document.cookie.indexOf(search);if(offset!=-1){offset+=search.length;end=document.cookie.indexOf(";",offset);if(end==-1){end=document.cookie.split("").length}cookieValue=document.cookie.substring(offset,end)}}var a=cookieValue.split("&");var o={};var haveVal=false;for(var i=0,l=a.length;i<l;i++){var k=a[i].split("=");if(k[0]!=""){o[k[0]]=k[1];haveVal=true}}return haveVal?o:false},formatDateTime:function(date){var y=date.getFullYear();var m=date.getMonth()+1;m=m<10?"0"+m:m;var d=date.getDate();d=d<10?"0"+d:d;var h=date.getHours();var minute=date.getMinutes();minute=minute<10?"0"+minute:minute;return y+"-"+m+"-"+d+" "+h+":"+minute}};String.prototype.trim=function(){return this.replace(/^\s*|\s*$/g,"")};var common_header={init:function(){var _this=this;_this.herderUI();_this.navUI();_this.inputUI()},islogined:function(){var loginInfo=utility.read("KuGoo");return loginInfo==""||loginInfo.toString()=="undefined"||loginInfo===false?false:true},herderUI:function(){var _this=this,login_in=document.getElementById("login_in"),login_btn=document.getElementById("login_btn"),login_out=document.getElementById("login_out"),user_menu=document.getElementById("user_menu"),menuT=null;if(_this.islogined()){var kugouC=utility.read("KuGoo"),user_name=kugouC.NickName.replace(/%/g,"\\"),user=eval("'"+user_name+"'"),uer_img=kugouC.Pic;$("#login_in").hide();$(login_out).show();$(login_out).find(".user_img").attr("src",uer_img);$(login_out).find(".user_name").html(user)}else{$("#login_btn").on("click",function(e){$.ajax({url:"http://static.kgimg.com/common/js/min/popuplogin-min.js?"+Math.round((new Date).getTime()/1e3),dataType:"script",success:function(){UsLogin()}})})}login_out.onmouseover=function(){user_menu.style.cssText="display:block;"};login_out.onmouseleave=function(){menuT=setTimeout(function(){user_menu.style.display="none"},300)};login_out.onclick=function(){window.open("http://www.kugou.com/newuc/user/uc/")};user_menu.onmouseover=function(){clearTimeout(menuT);user_menu.style.cssText="display:block;"};user_menu.onmouseleave=function(){user_menu.style.cssText="display:none"}},navUI:function(){var t=null;var More=document.getElementById("more");var showMore=document.getElementById("showMore");var subUl=document.getElementById("secondMenu");showMore.onclick=function(){return false};More.onmouseover=function(){this.setAttribute("class","more hover");showMore.setAttribute("class","icon icon-nav6");subUl.style.cssText="display:block;"};More.onmouseleave=function(){this.setAttribute("class","more");showMore.setAttribute("class","icon icon-nav6");t=setTimeout(function(){subUl.style.display="none"},300)};subUl.onmouseover=function(){clearTimeout(t);More.setAttribute("class","more hover");showMore.setAttribute("class","icon icon-nav6");subUl.style.cssText="display:block;"};subUl.onmouseleave=function(){More.setAttribute("class","more");showMore.setAttribute("class","icon icon-nav6");subUl.style.cssText="display:none"}},inputUI:function(){var _this=this,$searh_btn=$(".searh_btn"),$top_history=$(".top_search_histroy"),$top_search_recommend=$(".top_search_recommend"),$top_searchInput=$(".top_search .search_input input"),topTime=null,wordRecommendTime=null,downFlag=1,upFlag=2,defaultFlag=false;$top_history.on("click",".clear_histroy",function(){localStorage["s_keyword"]="";$top_history.find(".history_song_list").empty();$top_history.removeClass("show").addClass("hide")});_this.nofouce(function(data){defaultFlag=true;if(typeof data!="undefined"&&data.length!=0&&data.length!=""){if(_this.hasPlaceholder()){$top_searchInput.attr("placeholder",data[0]["keyword"])}else{$top_searchInput.val(data[0]["keyword"])}}});$searh_btn.on("click",function(){var type=$top_searchInput.attr("data")||"song",keyword=$top_searchInput.val();if(keyword==""){keyword=$top_searchInput.attr("placeholder")}window.open("http://www.kugou.com/yy/html/search.html#searchType="+type+"&searchKeyWord="+keyword)});$top_searchInput.on("keydown",function(e){var keyword=$top_searchInput.val(),histroydd=$(".top_search_histroy dd"),songdd=$(".top_search_recommend dl.recommend_song_list dd"),mvdd=$(".top_search_recommend dl.recommend_mv_list dd"),histroyIndex=$(".top_search_histroy dd.hover").index(),songIndex=$(".top_search_recommend .recommend_song_list dd.hover").index(),MvIndex=$(".top_search_recommend .recommend_mv_list dd.hover").index();if(e.keyCode===13){var type=$top_searchInput.attr("data"),keyword=$top_searchInput.val();window.open("http://www.kugou.com/yy/html/search.html#searchType="+type+"&searchKeyWord="+keyword)}else if(e.keyCode==38){if(songIndex!=-1){upFlag=1}else{upFlag=2}if($top_history.hasClass("show")){if(histroyIndex+1==0){histroydd.eq(histroydd.length-1).addClass("hover").siblings("dd").removeClass("hover")}else{histroydd.eq(histroyIndex-1).addClass("hover").siblings("dd").removeClass("hover")}}else if($top_search_recommend.hasClass("show")){if(mvdd.length==0&&songdd.length!=0){upFlag=1;if(songIndex+1==0){upFlag=1;songdd.removeClass("hover");songdd.eq(songdd.length-1).addClass("hover")}else{upFlag=1;songdd.removeClass("hover");songdd.eq(songIndex-1).addClass("hover")}}if(songdd.length==0&&mvdd.length!=0){upFlag=2;if(MvIndex+1==0){songdd.removeClass("hover");mvdd.eq(mvdd.length-1).addClass("hover")}else{mvdd.removeClass("hover");mvdd.eq(MvIndex-1).addClass("hover")}}if(songdd.length!=0&&mvdd.length!=0){if(upFlag==1){if(songIndex==0){upFlag=2;songdd.removeClass("hover");mvdd.eq(mvdd.length-1).addClass("hover")}else{songdd.removeClass("hover");songdd.eq(songIndex-1).addClass("hover")}}else{if(MvIndex+1==0){songdd.removeClass("hover");mvdd.eq(mvdd.length-1).addClass("hover")}else{if(MvIndex==0){upFlag=1;mvdd.removeClass("hover");songdd.eq(songdd.length-1).addClass("hover")}else{mvdd.removeClass("hover");mvdd.eq(MvIndex-1).addClass("hover")}}}}}if($top_history.hasClass("show")){$top_searchInput.val($(".search_histroy dd.hover").attr("title"))}else if($top_search_recommend.hasClass("show")){if(upFlag==1){$top_searchInput.val($(".top_search_recommend .recommend_song_list dd.hover").attr("title")).attr("data","song")}else{$top_searchInput.val($(".top_search_recommend .recommend_mv_list dd.hover").attr("title")).attr("data","mv")}}}else if(e.keyCode==40){if($top_history.hasClass("show")){if(histroyIndex+1==histroydd.length){histroydd.eq(0).addClass("hover").siblings("dd").removeClass("hover")}else{histroydd.eq(histroyIndex+1).addClass("hover").siblings("dd").removeClass("hover")}}else if($top_search_recommend.hasClass("show")){if(mvdd.length==0&&songdd.length!=0){downFlag=1;if(songIndex+1==songdd.length){songdd.removeClass("hover");songdd.eq(0).addClass("hover")}else{songdd.removeClass("hover");songdd.eq(songIndex+1).addClass("hover")}}if(songdd.length==0&&mvdd.length!=0){downFlag=2;if(MvIndex+1==songdd.length){mvdd.removeClass("hover");mvdd.eq(0).addClass("hover")}else{mvdd.removeClass("hover");mvdd.eq(MvIndex+1).addClass("hover")}}if(songdd.length!=0&&mvdd.length!=0){if(downFlag==1){if(songIndex+1==0){mvdd.removeClass("hover");songdd.eq(0).addClass("hover")}else{if(songIndex+1==songdd.length){downFlag=2;songdd.removeClass("hover");mvdd.eq(0).addClass("hover")}else{songdd.removeClass("hover");songdd.eq(songIndex+1).addClass("hover")}}}else{if(MvIndex+1==mvdd.length){downFlag=1;mvdd.removeClass("hover");songdd.eq(0).addClass("hover")}else{mvdd.removeClass("hover");mvdd.eq(MvIndex+1).addClass("hover")}}}}if($top_history.hasClass("show")){$top_searchInput.val($(".search_histroy dd.hover").attr("title"))}else if($top_search_recommend.hasClass("show")){if(downFlag==1){$top_searchInput.val($(".top_search_recommend .recommend_song_list dd.hover").attr("title")).attr("data","song")}else{$top_searchInput.val($(".top_search_recommend .recommend_mv_list dd.hover").attr("title")).attr("data","mv")}}}}).on("click",function(){defaultFlag=false;_this.displayTip()}).on("textchange",function(){if(!defaultFlag){_this.displayTip()}}).on("blur",function(){topTime=setTimeout(function(){if(!$top_history.hasClass("noData")){$top_history.fadeOut(100).addClass("hide").removeClass("show")}$top_search_recommend.fadeOut(100).addClass("hide").removeClass("show")},400)});$top_history.mouseover(function(){clearTimeout(topTime);$top_history.removeClass("hide").addClass("show")});$top_history.on("click","dd",function(){var keyword=$(this).attr("title");$top_searchInput.val(keyword);window.open("http://www.kugou.com/yy/html/search.html#searchType=song&searchKeyWord="+keyword);$top_history.removeClass("show").addClass("hide");return false});$top_search_recommend.mouseover(function(){clearTimeout(topTime);$top_history.removeClass("hide").addClass("show")});$top_search_recommend.on("click","dd",function(){var keyword=$(this).attr("title");$top_searchInput.val(keyword);_this.keywordStorge(keyword);window.open("http://www.kugou.com/yy/html/search.html#searchType="+$(this).attr("data-type")+"&searchKeyWord="+keyword);$top_search_recommend.removeClass("show").addClass("hide");return false})},nofouce:function(callback){$.ajax({type:"GET",url:"http://so.service.kugou.com/v1/word_nofocus?platform=pc",dataType:"jsonp",success:function(res){if(res["status"]==1){callback(res["data"])}else{callback("")}},error:function(res){callback("")}})},displayTip:function(){var _this=this,$top_history=$(".top_search_histroy"),$top_search_recommend=$(".top_search_recommend"),$top_searchInput=$(".top_search .search_input input"),topTime=null,wordRecommendTime=null;if($top_searchInput.val()!=""){$top_history.fadeOut(100).addClass("hide").removeClass("show");clearTimeout(wordRecommendTime);wordRecommendTime=setTimeout(function(){_this.wordRecommend({keyword:$top_searchInput.val(),callback:function(str){if(str!=""){$top_search_recommend.html(str).fadeIn(100).addClass("show").removeClass("hide")}}})},10)}else{$top_search_recommend.fadeOut(100).addClass("hide").removeClass("show");_this.historyHtml(function(str){if(str!=""){$top_history.html(str).fadeIn(100).addClass("show").removeClass("hide")}else{$top_history.addClass("noData")}})}},wordRecommend:function(options){var defaults={keyword:"",MusicTipCount:5,MVTipCount:2,albumcount:2},_this=this;var op=$.extend(defaults,options);$.ajax({type:"GET",url:"http://searchtip.kugou.com/getSearchTip?MusicTipCount=5&MVTipCount=2&albumcount=2&keyword="+encodeURIComponent(op.keyword),crossDomain:true,dataType:"jsonp",success:function(res){if(res["status"]==1){if(res["data"]){var recommendhtml=_this.RecommendHtml(res["data"],op.keyword);options.callback(recommendhtml)}}else{options.callback("")}},error:function(res){options.callback("")}})},RecommendHtml:function(wordData,keyword){try{var recommendSongstr="<dl class='recommend_song_list recommend_list'>";var recommendMvstr="<h4><span class='icon_arrow'></span>MV</h2><dl class='recommend_mv_list recommend_list'>",songData=null,mvData=null;if(wordData[0]){songData=wordData[0].RecordDatas}if(wordData[1]){mvData=wordData[1].RecordDatas}if(songData.length==0){recommendSongstr=""}else{for(var i=0,Songlen=songData.length;i<Songlen;i++){var matchText="/"+keyword+"/";var textem=songData[i]["HintInfo"].replace(eval(matchText),"<em>"+keyword+"</em>");recommendSongstr+="<dd data-type='song' title='"+songData[i]["HintInfo"]+"'>"+textem+"</dd>"}recommendSongstr+="</dl>"}if(mvData.length==0){return recommendSongstr}else{for(var j=0,Mvlen=mvData.length;j<Mvlen;j++){var matchText="/"+keyword+"/";var textem=mvData[j]["HintInfo"].replace(eval(matchText),"<em>"+keyword+"</em>");recommendMvstr+="<dd data-type='mv' title='"+mvData[j]["HintInfo"]+"'>"+textem+"</dd>"}recommendMvstr+="</dl>"}return recommendSongstr+recommendMvstr}catch(ex){}},historyHtml:function(callback){var historyData;if(localStorage["s_keyword"]!=""&&typeof localStorage["s_keyword"]!="undefined"){historyData=localStorage["s_keyword"].split("|").reverse()}if(typeof historyData!="undefined"){if(historyData.length==0){callback("")}else{var historyStr="<dl class='history_song_list'>";for(var i=0,len=historyData.length;i<len;i++){historyStr+='<dd title="'+historyData[i]+'">'+historyData[i]+"</dd>"}historyStr+="</dl><dl class='clear_histroy'><dt>清空历史记录</dt></dl>";callback(historyStr)}}else{return}},hasPlaceholder:function(){var attr="placeholder";var input=document.createElement("input");return attr in input},keywordStorge:function(keyword){var historyData=[],_this=this,i,len,deleteflag=false,deleteindex,limitLen=5;if(localStorage["s_keyword"]!=""&&typeof localStorage["s_keyword"]!="undefined"){historyData=localStorage["s_keyword"].split("|")}for(i=0,len=historyData.length;i<len;i++){if(historyData[i]==keyword){deleteflag=true;deleteindex=i}}if(deleteflag){historyData.splice(deleteindex,1)}if(historyData.length>=limitLen){historyData=historyData.slice(historyData.length-4,historyData.length)}historyData.push(keyword);localStorage["s_keyword"]=historyData.join("|")},unique:function(arr){var tmpArr=[],hash={};for(var i=0;i<arr.length;i++){if(!hash[arr[i]]){hash[arr[i]]=true;tmpArr.push(arr[i])}}return tmpArr}};var fanxingAdT=null;var play={globalParam:{globalID:0,isAudioStop:false,isStop:true,isPlayDrop:false,beginClientX:0,begingPlayHeadX:0,isVolumeDrop:false,beginClientY:0,begingVolumeHeadY:0,myAudio:null,volumeMode:"icon icon-playbar-maxvox",volumeNum:"0.6",songDuration:0,duration:"",songName:"",songIndex:0,songW:0,doubEx:0,songNameEle1:null,songNameEle2:null,songNameEle1Left:null,songNameEle2Left:null,isFirstPlay:true,wordArr:null,wordArrLen:0,wordArrHTML:null,ind:-2,currentPlayStatus:false,fristFlag:true,showPlayFlag:false},init:function(){var _this=this,locationFrom=location.href,reg=/\d+/g,ua=navigator.userAgent.toLowerCase(),ipad=/ipad/gi.test(ua),android=/android|Adr/gi.test(ua),iphone=/iphone/gi.test(ua),frwrap=/fr=wrap/gi.test(locationFrom),$songWordContent=$("#songWordContent");if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){var songmd5Id=locationFrom.match(/song\/(.*).html/)[1];if(songmd5Id!=null&&typeof songmd5Id!="undefined"&&songmd5Id!=""){songmd5Id=songmd5Id.split(",")[0];window.location="http://m.kugou.com/kgsong/"+songmd5Id+".html"+location.search}else{if(android){window.location="http://mo.kugou.com/download/app/index.php?plat=0&fr=kugou"}else if(iphone){window.location="http://mo.kugou.com/download/app/index.php?plat=1&fr=kugou"}}}var loadBefor="",reffer=document.referrer,kugouC=utility.read("KuGoo"),kuLogin=$(".kuLogin"),user_name=kugouC.NickName,user;window.downloadUrl="http://download.kugou.com/download/kugou_pc";if(locationFrom.indexOf("baidu")!=-1||reffer.indexOf("baidu.com")!=-1){loadBefor="百度";window.downloadUrl="http://xiazai.kugou.com/Corp/kugou7_3762.exe"}else if(locationFrom.indexOf("sogou")!=-1||reffer.indexOf("sogou")!=-1){loadBefor="搜狗";window.downloadUrl="http://xiazai.kugou.com/Corp/kugou7_3814.exe"}else if(locationFrom.indexOf("360")!=-1||reffer.indexOf("so.com")!=-1){loadBefor="360";window.downloadUrl="http://xiazai.kugou.com/Corp/kugou7_3500.exe"}else if(reffer.indexOf("360.cn")!=-1){loadBefor="360导航页"}else if(reffer.indexOf("google.com")!=-1){loadBefor="谷歌"}else if(reffer==""||reffer.indexOf("kugou.com")!=-1||reffer.indexOf("download.com")!=-1){loadBefor="直接访问"}else if(reffer!=""){loadBefor="其他访问"}window.kugou_id=kugouC.KugooID;var pageLoadedData=_this.commonConfig();pageLoadedData["action"]="index";pageLoadedData["b"]="播放页访问";pageLoadedData["a"]=2;pageLoadedData["o"]=loadBefor;var Loaded=[30032,pageLoadedData];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}$(".mainPage").height($(window).height());_this.resizeUI();$(window).resize(function(){var resizeUIt=setTimeout(function(){clearTimeout(resizeUIt);_this.resizeUI()},800)});var playList=$(".songjsAction").jScrollPane({hijackInternalLinks:true,animateScroll:true,autoReinitialise:true});_this.playListApi=playList.data("jsp");$.jStorage.set("playFlag","true");$.jStorage.set("newsong",null);_this.playInit();_this.playList();_this.playListbindUI();_this.setActive(0);if(location.hash!=""){var urlHash=utility.QueryString("hash");var album_id=utility.QueryString("album_id")}if(typeof urlHash!="undefined"&&urlHash!=""&&urlHash!=null){_this.getdatabyhash({Hash:urlHash,album_id:album_id,callback:function(res){if(res["status"]!=0&&res["data"].length!=0){var songs=[],songData={};songData["Hash"]=res["data"]["hash"];songData["audio_name"]=res["data"]["audio_name"];songData["author_name"]=res["data"]["author_name"];songData["timelength"]=res["data"]["timelength"];songData["album_id"]=res["data"]["album_id"];songs.push(songData);var resSong=JSON.stringify(songs);$.jStorage.set("newsong",resSong)}else{var unshare=dialog({width:300,height:100,title:"获取数据失败",skin:"getdatafail",content:"获取数据失败，稍后重试"}).show();if(_this.globalParam.length>1){_this.playSong(_this.globalParam.songIndex+=1)}}}})}else{var data=JSON.parse($.jStorage.get("k_play_list"))||[];if(data.length!=0){_this.playSong(_this.globalParam.songIndex)}else{_this.warnAddSong();return}}},commonConfig:function(){var _this=this,kugouC=utility.read("KuGoo"),kugou_id=kugouC.KugooID;return{lvt:utility.formatDateTime(new Date),os:utility.detectOS(),browser:utility.getBrowser()["type"]||"",uid:kugou_id||"",fo:"播放页"}},warnAddSong:function(){var _this=this;var empty={hash:"",timelength:0,filesize:0,audio_name:"",have_album:0,album_name:"",album_id:0,img:"",have_mv:0,video_id:0,author_name:"",song_name:"",lyrics:"",author_id:0,privilege:0,privilege2:0,play_url:"",newlyrics:"",Hash:""};_this.updateUI(empty,function(){$(".btnArea2").hide();$(".songWordContent .jspPane").html('<div class="no_song"><p class="nosong_tilte">暂无播放歌曲</p><p class="nosong_tip">你可以去酷狗网页添加歌曲</p><a class="goIndex" target="_blank" href="http://www.kugou.com/">去首页逛逛</a></div>');$(".songjsAction .jspPane").html('<div class="noSongList"><p class="noSongListTip">队列中还没有歌曲</p><p class="addSongLink">去<a target="_blank"  href="http://www.kugou.com/" class="gotoIndex">首页</a>添加歌曲</p></div>')});clearInterval(fanxingAdT);$(".fangxinAd").hide()},updateUI:function(option,callback){var _this=this;audioName=$(".audioName"),$content=$(".content"),$blurBg=$("#blurBg"),defaultImg="http://www.kugou.com/yy/static/images/play/default.jpg";$(".btnArea2").show();if(typeof option.img=="undefined"||option.img==""||option.img==null){option.img=defaultImg}if(utility.getBrowser()["type"]=="ie"){$content[0].style.cssText=$content[0].style.cssText+"background-image: url('http://www.kugou.com/yy/static/images/iebg.jpg');";$blurBg.hide();_this.resizeUI()}else{$blurBg[0].style.cssText="background-image: url('"+option.img+"');"}if(option.have_album){var albumName_a=$(".albumName a");var albumImg_a=$(".albumImg a");var barAlbumImg_a=$(".bar-albumImg a");var albumLink="http://www.kugou.com/album/"+option.album_id+".html";$(".albumName").show();if(albumName_a.length>0){albumName_a.text(option.album_name).attr("title",option.album_name).attr("href",albumLink)}else{$(".albumName").html('<span class="fl fontColor">专辑：</span><a class="fl" href="'+albumLink+'" title="'+option.album_name+'">'+option.album_name+"</a>")}if(albumImg_a.length>0){albumImg_a.attr("title",option.album_name).attr("href",albumLink);albumImg_a.find("img").attr("src",option.img)}else{$(".albumImg").html('<a class="fl" target="_blank" href="'+albumLink+'"title="'+option.album_name+'"><img onerror="this.onerror=null;this.src='+option.img+'"  src='+option.img+"></a>")}if(barAlbumImg_a.length>0){barAlbumImg_a.attr("title",option.album_name).attr("href",albumLink);barAlbumImg_a.find("img").attr("src",option.img)}else{$(".bar-albumImg").html('<a target="_blank" href="'+albumLink+'"title="'+option.album_name+'"><img onerror="this.onerror=null;this.src='+option.img+'" src='+option.img+"></a>")}}else{$(".albumName").hide();$(".albumImg,.bar-albumImg").html('<img src="'+option.img+'">')}if(option.have_mv){$(".btnMv").attr("href","http://www.kugou.com/mvweb/html/mv_"+option.video_id+".html").show()}else{$(".btnMv").hide()}option.audio_name=$(".musiclist li.active").find(".musiclist-songname-txt").text();if(typeof option.audio_name=="undefined"||option.audio_name==""||option.audio_name==null){option.audio_name="酷狗音乐 - 音乐总有新玩法"}$("#songName,.audioName").html(option.audio_name).attr("title",option.audio_name);$("#songNameTemp:hidden").html(utility.playEncode(option.audio_name)).attr("title",option.audio_name);clearInterval(fanxingAdT);fanxingAdT=setInterval(function(){_this.fanxingAjax(option.audio_name)},2e4);_this.fanxingAjax(option.audio_name);var $singerName=$(".singerName"),singerHtml='<span class="fontColor">歌手：</span>',authors="",authorsTitle="";$(option.authors).each(function(index){if($(this)[0].is_publish=="1"&&$(this)[0].author_id!="0"){singerHtml+='<a target="_blank" href="http://www.kugou.com/singer/'+$(this)[0].author_id+'.html" title="'+$(this)[0].author_name+'">'+$(this)[0].author_name+"</a>"}else{singerHtml+=$(this)[0].author_name}authors+=$(this)[0].author_name+"_";authorsTitle+=$(this)[0].author_name+"、"});if(singerHtml=='<span class="fontColor">歌手：</span>'){$singerName.hide()}else{$singerName.show().html(singerHtml).attr("title",authorsTitle)}if(option.audio_name!=""&&option.audio_name!=null&&option.audio_name!="undefined"){document.title=option.audio_name+"_"+authors+"_高音质在线试听_"+option.audio_name+"歌词|歌曲下载_酷狗音乐 ";clearInterval(_this.globalParam.tilteSCroll);_this.globalParam.tilteSCroll=setInterval(function(){_this.titlescroll()},700)}else{document.title="酷狗音乐";clearInterval(_this.globalParam.tilteSCroll)}if(option.audio_name){_this.globalParam.songName=utility.htmlEncode2(option.audio_name)}if(audioName.width()>430){audioName.css({width:"430"+"px",overflow:"hidden",whiteSpace:"nowrap",float:"left",textOverflow:"ellipsis"})}$(".no_song").remove();var word=option["lyrics"].replace(/%/g,"\\"),songword=word.replace(/\[(.*)\]/g,'</p><p class="ie8FontColor">').replace(/<\/p>/,"")+"</p>";_this.globalParam.word=word;if($(".songWordContentM .jspPane").length>0){$(".songWordContentM .jspPane").html(songword)}else{$(".songWordContentM").html(songword);$(".songWordContent").jScrollPane({hijackInternalLinks:true,animateScroll:true,autoReinitialise:true})}if(typeof myAudio=="undefined"&&myAudio==null){myAudio=document.getElementById("myAudio")}if(option.play_url==""){myAudio.src=option.play_url;var flag1=option.hash&&option.hash!=""&&option.play_url=="";var wranText="这首歌曲无版权暂不支持播放";if(option["privilege2"]){var privilege2=option["privilege2"].split("").pop()=="0";if(privilege2){wranText="这首歌是付费歌曲请下载客户端播放"}}if(flag1){var d=dialog({title:"提示",width:370,height:133,content:['<div class="dialogContent clearfix" id="forbidPlay">','<div class="contetText">'+wranText+"</div>",'<div class="dialogFooter clearfix">','<a class="btnDl" id="iKown">我知道了</a>',"</div>","</div>"].join(""),onshow:function(){$(".btnDl").off("click").on("click",function(e){e.preventDefault();$(".ui-dialog-close").trigger("click");_this.playSong(_this.globalParam.songIndex+=1)})}}).show();$("#toggle").trigger("click")}}else{myAudio.src=option.play_url;myAudio.load()}callback&&callback()},titlescroll:function(){var _this=this;var dir="left";var title=document.title;if(dir=="left"&&title!="酷狗音乐"){var firstch=title.charAt(0);var leftstr=title.substring(1,title.length);document.title=leftstr+firstch}else{clearInterval(_this.globalParam.tilteSCroll)}},fanxingAjax:function(songName){var _this=this;if(songName!=""&&songName!="undefined"&&songName!=null){$.ajax({type:"GET",url:"http://ad.fanxing.kugou.com/part/pclrc?jsonCallBack&songName="+encodeURIComponent(songName.toString().split("-").pop().trim()),dataType:"jsonp",success:function(res){if(res["roomUrl"]!=""){$(".fangxinAd").show();$(".fangxinAd .singerImg").attr("src",res.imagePath);$(".fangxinAd .singerName").html("【"+res.nickName+"】正在直播");$(".fangxinAd .singingName").html(songName);$(".fangxinAd .goto a").attr("href",res.roomUrl);$(".fangxinAd .goto a").off("click").on("click",function(e){e.preventDefault()});$(".fangxinAd").off("click").on("click",function(e){try{var roomid=utility.QueryString(decodeURIComponent($(this).find("a").attr("href")),"url").match(/\d*$/)[0];(new Image).src="http://channel.fanxing.kugou.com/room/newkugouweb?room="+roomid+"&t="+Math.random()}catch(ex){}var clickObj=_this.commonConfig();clickObj["action"]="click";clickObj["b"]="点击歌词直播浮层";clickObj["a"]=210;var Clickdata=[30032,clickObj,null,0];apmCollectData.push(Clickdata);try{newLogCount()}catch(ex){}window.open($(this).find("a").attr("href"))});var fanxinObj=_this.commonConfig();fanxinObj["action"]="other";fanxinObj["b"]="歌词页直播浮层出现";fanxinObj["a"]=209;var fanxindata=[30032,fanxinObj,null,0];apmCollectData.push(fanxindata);try{newLogCount()}catch(ex){}}else{$(".fangxinAd").hide()}},error:function(res){clearInterval(fanxingAdT);$(".fangxinAd").hide()}})}else{clearInterval(fanxingAdT)}},playSong:function(P_index){var _this=this;if(_this.globalParam.songLength==0){return}var play_index=typeof P_index!="undefined"?P_index:_this.globalParam.songIndex+=1,PlayList=_this.getPlayList();Hash=typeof PlayList[play_index]!="undefined"&&typeof PlayList[play_index]["Hash"]!="undefined"&&PlayList[play_index]["Hash"]!=null&&PlayList[play_index]["Hash"]!=""?PlayList[play_index]["Hash"]:"",album_id=typeof PlayList[play_index]!="undefined"&&typeof PlayList[play_index]["album_id"]!="undefined"&&PlayList[play_index]["album_id"]!=null&&PlayList[play_index]["album_id"].toString()!=""?PlayList[play_index]["album_id"]:"",playfrom=typeof PlayList[play_index]!="undefined"&&typeof PlayList[play_index]["from"]!="undefined"&&PlayList[play_index]["from"]!=null&&PlayList[play_index]["from"].toString()!=""?PlayList[play_index]["from"]:"",audio_name=typeof PlayList[play_index]!="undefined"&&typeof PlayList[play_index]["audio_name"]!="undefined"&&PlayList[play_index]["audio_name"]!=null&&PlayList[play_index]["audio_name"].toString()!=""?PlayList[play_index]["audio_name"]:"",bi_fo="";if(playfrom=="精选歌单"){bi_fo="首页/精选歌单"}else if(playfrom.indexOf("热门榜单")!=-1){bi_fo="首页/"+playfrom}else if(playfrom=="新歌首发"){bi_fo="首页/新歌首发"}else if(playfrom=="search"){bi_fo="搜索页"}else if(playfrom!=""){bi_fo="榜单页/"+playfrom}else{bi_fo="其他"}$.jStorage.set("playdata",true);_this.playListApi.scrollToY(play_index*40);$("#musicbox li").eq(play_index).addClass("active").siblings("li").removeClass("active");if(Hash!=""&&album_id.toString()!=""){location.hash="hash="+Hash+"&album_id="+album_id}else if(Hash!=""){location.hash="hash="+Hash}else if(Hash==""){return}$(".fangxinAd").hide();_this.getdatabyhash({Hash:Hash,album_id:album_id,callback:function(res){if(res["status"]!=0&&res["data"]!=0){_this.updateUI(res["data"]);_this.globalParam.lyricsheight=$(".jspPane").height();_this.globalParam.lyricsOverflowheight=$(".songWordContent").height();$.ajax({type:"GET",url:"http://ip.kugou.com/check/iscn?&format=jsonp",dataType:"jsonp",timeout:3e3,success:function(res){if(res["status"]){if(res["flag"]==0){var unshare=dialog({width:310,height:50,title:"提示",skin:"unshare",cancel:false,content:"抱歉，您所在的国家或地区暂无法提供此歌曲服务"}).showModal();setTimeout(function(){_this.globalParam.myAudio.pause();$("#myAudio").remove();_this.audioStop()},1e3);return}}},error:function(xhr,type){}});if(_this.globalParam.fristFlag){_this.callExe({song_info:res["data"],link:location.href,type:"play"});_this.globalParam.fristFlag=false}if(res["data"].play_url!=""){playOpen();_this.audioStart();_this.playOnStart();var playbiObj=_this.commonConfig();playbiObj["action"]="index";playbiObj["a"]=6;playbiObj["b"]="播放";playbiObj["fo"]=bi_fo;playbiObj["ivar1"]="音频";playbiObj["ivar2"]=Hash;playbiObj["ivar3"]=audio_name;var bidata=[30032,playbiObj,null,0];apmCollectData.push(bidata);try{newLogCount()}catch(ex){}}else{_this.audioStop();_this.setStatus()}}else{clearInterval(fanxingAdT);$(".fangxinAd").hide();_this.audioStop();var unshare=dialog({width:300,height:100,title:"获取数据失败",skin:"getdatafail",content:"获取数据失败"}).show()}}})},playListbindUI:function(){var _this=this;$(".btnDownloadClient").off("click").on("click",function(e){e.preventDefault();_this.downloadError({type:"current"});var data=_this.commonConfig();data["action"]="click";data["b"]="下载btn";data["a"]=200;data["ivar4"]="歌词";var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}});$(".clear").off("click").on("click",function(){_this.audioStop();$(".musiclist").remove();$.jStorage.set("k_play_list",null)});$(".closePlayList").off("click").on("click",function(){$("#list").trigger("click")});$(document).on("mousedown",function(){var $mode_panel=$("#mode_panel");if(_this.globalParam.showPlayFlag){_this.showPlaylist(false)}if($mode_panel.css("display")=="block"){$mode_panel.hide()}});$("#musicbox .list-action-down").off("click").on("click",function(e){e.stopPropagation();var clickIndex=$(this).closest("li").index(),clickdata=_this.getPlayList()[clickIndex],Hash=clickdata["Hash"],albumId=clickdata["album_id"];_this.downloadError({type:"list",Hash:Hash,albumId:albumId,clickIndex:clickIndex});var data=_this.commonConfig();data["action"]="click";data["a"]=200;data["b"]="下载btn";data["ivar4"]="播放队列";var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}});$("#musicbox .list-action-share").off("click").on("click",function(e){e.stopPropagation();var data=_this.getPlayList()[$(this).closest("li").index()],Hash=data["Hash"],albumId=data["album_id"];var listSongName=$(this).closest("li").find(".musiclist-songname-txt").text().trim(),listSingerName=$(this).closest("li").find(".musiclist-artist").text().trim();_this.getdatabyhash({Hash:Hash,album_id:albumId,callback:function(res){if(res["status"]!=0&&res["data"].length!=0){var shareData=$.extend(res["data"],{
audio_name:listSingerName+"-"+listSongName});_this.share(shareData)}else{var unshare=dialog({width:200,height:50,title:"分享失败",skin:"unshare",content:"分享失败，稍后重试"}).show();setTimeout(function(){unshare.close().remove()},3e3)}}});var data=_this.commonConfig();data["action"]="click";data["b"]="分享btn";data["ivar4"]="ivar4";data["a"]=203;var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}});$("#musicbox .list-action-del").off("click").on("click",function(e){e.stopPropagation();var index=$(this).closest("li").index();var k_play_list=_this.getPlayList();k_play_list.splice(index,1);$.jStorage.set("k_play_list",JSON.stringify(k_play_list));_this.playListApi.scrollToY(_this.globalParam.songIndex*40);if(index<_this.globalParam.songIndex){_this.globalParam.songIndex--;_this.setActive(_this.globalParam.songIndex)}else if(index==_this.globalParam.songIndex){if(_this.globalParam.songIndex>=_this.globalParam.songLength-1){_this.globalParam.songIndex=0}_this.playSong(_this.globalParam.songIndex)}else{_this.setActive(_this.globalParam.songIndex)}});$("#musicbox .musiclist-item").off("click").on("click",function(){var Hash=$(this).attr("data-h");var index=$(this).parent().index();$(this).parent().addClass("active");$(this).parent().siblings("li").removeClass("active");_this.globalParam.songIndex=index;_this.playSong(index)})},showPlaylist:function(type){var _this=this;var $playlist=$("#mod-playlist");if(type==true){$playlist.css({bottom:"80px"});_this.globalParam.showPlayFlag=true}else{$playlist.css({bottom:0-$playlist.height()+"px"});_this.globalParam.showPlayFlag=false}},setActive:function(index){$("#musicbox li").eq(index).addClass("active")},getdatabyhash:function(option){var _this=this;$.ajax({type:"GET",url:"http://www.kugou.com/yy/index.php?r=play/getdata",cache:false,timeout:5e3,data:{hash:option.Hash,album_id:option.album_id},dataType:"json",success:function(res){$.jStorage.set("playdata","true");option.callback(res)},error:function(res){$.jStorage.set("playdata","true");option.callback({status:0});_this.globalParam.isAudioStop=true}})},playList:function(){var _this=this;var k_play_list=[];var playExist=(new Date).getTime();$.jStorage.set("playExist",playExist);$.jStorage.set("playFlag","true");$.jStorage.listenKeyChange("playExist",function(key,action){if($.jStorage.get("playExist")>playExist){playExist=$.jStorage.get("playExist");_this.audioStop()}});if($.jStorage.get("k_play_list")){k_play_list=JSON.parse($.jStorage.get("k_play_list"))||[]}else{k_play_list=[]}if(dataFromSmarty!=null&&typeof dataFromSmarty!="undefined"&&dataFromSmarty.length!=0&&dataFromSmarty.length!=""){var reverseData=dataFromSmarty.reverse();for(var i=0,len=reverseData.length;i<len;i++){reverseData[i]["Hash"]=reverseData[i]["hash"];if(reverseData[i]["Hash"]!=null&&reverseData[i]["Hash"]!=""&&typeof reverseData[i]["Hash"]!="undefined"){k_play_list.unshift(reverseData[i])}}}k_play_list=_.uniq(k_play_list,"Hash");_this.globalParam.songLength=k_play_list.length;$("#list_count").html(k_play_list.length);$(".box-header span").eq(0).html(k_play_list.length);_this.renderPlayList(k_play_list);if(k_play_list.length!=0){_this.showTip()}$.jStorage.set("k_play_list",JSON.stringify(k_play_list));$.jStorage.listenKeyChange("newsong",function(key,action){$.jStorage.set("playdata",true);var newSong=JSON.parse($.jStorage.get("newsong"));if(_.isArray(newSong)){k_play_list=JSON.parse($.jStorage.get("k_play_list"))||[];k_play_list=utility.insertArrayAt(k_play_list,0,newSong);k_play_list=_.uniq(k_play_list,"Hash");$.jStorage.set("k_play_list",JSON.stringify(k_play_list));_this.globalParam.songIndex=0;_this.playSong(_this.globalParam.songIndex);_this.showTip();$("#musicbox li").eq(_this.globalParam.songIndex).addClass("active")}});$.jStorage.listenKeyChange("k_play_list",function(key,action){var newPlaySong=JSON.parse($.jStorage.get("k_play_list"))||[];if(_.isArray(newPlaySong)){k_play_list=newPlaySong;$("#list_count").text(newPlaySong.length);$(".box-header span").eq(0).html(newPlaySong.length);_this.globalParam.songLength=newPlaySong.length;_this.renderPlayList(newPlaySong);_this.playListbindUI()}if(newPlaySong.length==0){_this.warnAddSong()}})},showTip:function(){$(".play_tips:hidden").show().animate({opacity:1});var play_tipsT=setTimeout(function(){$(".play_tips").animate({opacity:0})},1e3)},getPlayList:function(){var PlayList=JSON.parse($.jStorage.get("k_play_list"))||[];if(_.isArray(PlayList)){return PlayList}},renderPlayList:function(data){var _this=this,PlayListStr='<div class="musiclist">',actionDom=$("#musicbox .jspPane"),tempString="345";if(data.length!=0){$(".noSongList").remove();for(var i=0,len=data.length;i<len;i++){if(typeof data[i]["Hash"]=="undefined"&&data[i]["Hash"]==null&&data[i]["Hash"]==""){continue}var tempLen=data[i]["timelength"].toString().length,restime=tempLen==tempString.length?data[i]["timelength"]*1e3:data[i]["timelength"],time=utility.getMS(restime),hash=data[i]["Hash"],album_id=data[i]["album_id"],authorNames,songname;var splitIndex=data[i]["audio_name"].indexOf("-");if(splitIndex!=-1){songname=data[i]["audio_name"].substring(splitIndex+1);authorNames=data[i]["audio_name"].substring(0,splitIndex)}else{songname=data[i]["audio_name"];authorNames=data[i]["author_name"]}PlayListStr+='<li><div class="musiclist-item clearfix">'+'<span class="musiclist-number">'+(i+1)+"</span>"+'<div class="musiclist-name">'+'<span class="musiclist-songname-txt" title="'+songname+'">'+songname+"</span>"+'<div class="mod-list-menu">'+'<a href="javascript:;" class="icon list-menu-item icon-playbar-download list-action-down" title="下载">'+'<i class="icon list-menu-icon-down"></i>'+'<span class="icon_txt">下载</span>'+"</a>"+'<a href="javascript:;" class="icon list-menu-item icon-playbar-share list-action-share" title="分享">'+'<i class="icon list-menn-icon-share"></i>'+'<span class="icon_txt">分享</span>'+"</a>"+'<a href="javascript:;" class="icon list-menu-item list-menu-icon-del list-action-del" title="删除歌曲">'+'<i class="icon list-menu-icon-add"></i>'+'<span class="icon_txt">删除</span>'+"</a>"+"</div>"+"</div>"+'<div class="musiclist-artist" title="'+authorNames+'">'+authorNames+"</div>"+'<div class="musiclist-time">'+time+"</div>"+"</div></li>"}PlayListStr+="</div>";_this.height=actionDom.height();actionDom.height(_this.height);actionDom.empty().append(PlayListStr).attr("style","")}else{$(".musiclist").remove();_this.setStatus()}},callExe:function(option){var _this=this,songData=option.song_info,comeFrom=option.link,type=option.type,privilege2=songData["privilege2"]?songData["privilege2"].split("").pop()=="0":"1",songWord=songData["audio_name"].length>58?songData["audio_name"].substring(0,58)+"...":songData["audio_name"],controlData='{"Files":[{"filename":"'+songWord+'.mp3","hash":"'+songData["hash"]+'","size":"'+songData["filesize"]+'","duration":"'+songData["timelength"]+'","bitrate":"128","isfilehead":"100","privilege":"'+songData["privilege"]+'","album_id":"'+songData["album_id"]+'"}]}';var callT=setTimeout(function(){$.ajax({url:"http://www.kugou.com/yy/static/js/jslib/base.js?"+Math.round((new Date).getTime()/1e3),dataType:"script",success:function(){if(type=="download"){var url="kugou://"+type+"?p="+Base64.encode(controlData);if(utility.getBrowser()["v"]==6||utility.getBrowser()["v"]==7||utility.getBrowser()["v"]==8){window.open(url)}else{$("#apply:hidden").attr("src",url)}}else if(type=="play"){if(comeFrom.indexOf("frombaidu")!=-1||comeFrom.indexOf("from_360")!=-1||comeFrom.indexOf("from_sogou")!=-1){var url="kugou://"+type+"?p="+Base64.encode(controlData);if(utility.getBrowser()["v"]==6||utility.getBrowser()["v"]==7||utility.getBrowser()["v"]==8){window.open(url)}else{$("#apply:hidden").attr("src",url)}}}clearTimeout(callT)},error:function(){clearTimeout(callT)}})},1e3)},resizeUI:function(){var _this=this,winWidth=$(window).width(),winHeight=$(window).height(),headerH=$(".header").height(),navWrapH=$(".navWrap").height(),contentHeight=winHeight-headerH-navWrapH,bgBlur=$(".bg-blur"),singerContent=$(".singerContent"),songWordContent=$(".songWordContent");$("#blurBg").height(contentHeight);$(".content").height(contentHeight);$(".mainPage").height(winHeight);if(winHeight<=895){singerContent.css({marginTop:100-(895-winHeight)/2<=10?10:100-(895-winHeight)/2})}else{singerContent.css({marginTop:100})}if(winHeight<=780){songWordContent.css({height:410-(780-winHeight)<=235?235:410-(780-winHeight)})}else{songWordContent.css({height:410})}},downloadError:function(option){var _this=this;if(_this.downloadd){return}_this.downloadd=dialog({title:"提示",width:380,height:170,skin:"playsong",fixed:true,content:[' <div class="dialogContent clearfix" id="download">','<div class="contetText">','<p><span class="warn_icon"><img src="http://www.kugou.com/yy/static/images/play/warn.png"></span>下载歌曲需要在酷狗音乐客户端操作</p></div>','<div class="dialogFooter clearfix">','<a href="#" class="callClient">打开客户端</a>',"<a href=\"#\" class=\"btnDl\" onclick=\"_hmt.push(['_trackEvent', 'song3software', 'song3download', 'song3kugou']);\" >下载新版客户端</a>","</div>"," </div>"].join(""),onshow:function(){$(".ui-dialog").mousedown(function(){if($("#mod-playlist").css("bottom")=="80px"){_this.showPlaylist(true)}});$(".btnDl").off("click").on("click",function(e){e.preventDefault();var win=window.open(window.downloadUrl);var data=_this.commonConfig();data["action"]="click";data["b"]="歌曲下载弹窗-下载新版客户端btn";data["a"]=202;var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}_this.downloadd.close().remove()});$(".callClient").off("click").on("click",function(e){e.preventDefault();var currentHash=null;if(option.type="current"){var currentIndex=$(".musiclist .active").index(),currentHash=_this.getPlayList()[currentIndex]["Hash"],currentAlbumId=_this.getPlayList()[currentIndex]["album_id"],listSongName=$(".musiclist li.active").find(".musiclist-songname-txt").text().trim(),listSingerName=$(".musiclist li.active").find(".musiclist-artist").text().trim()}else if(option.type="list"){var currentHash=option.Hash;currentAlbumId=option.album_id;listSongName=$(".musiclist li").eq(option.clickIndex).find(".musiclist-songname-txt").text().trim(),listSingerName=$(".musiclist li").eq(option.clickIndex).find(".musiclist-artist").text().trim()}_this.getdatabyhash({Hash:currentHash,album_id:currentAlbumId,callback:function(res){if(res["status"]!=0&&res["data"].length!=0){var downloadData=$.extend(res["data"],{audio_name:listSingerName+"-"+listSongName});_this.callExe({type:"download",song_info:downloadData,link:location.href})}}});var data=_this.commonConfig();data["action"]="click";data["b"]="歌曲下载弹窗-打开客户端btn";data["a"]=201;var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}_this.downloadd.close().remove()})},onclose:function(){_this.downloadd=null}});_this.downloadd.show()},downLoad:function(a,b,callback){var _this=this;var c,d,e,f,downloadUrl=window.downloadUrl||" http://xiazai.kugou.com/Corp/kugou7_3762.exe";a=unescape(a);if(0==b)return alert("请先选择歌曲！"),!1;try{if(c=null,c=window.kugouAX?window.kugouAX:new ActiveXObject("KuGoo3DownXControl.KuGoo3Down"),a=JSON.parse(a),d="",b>1)for(e=0;e<a.length;e++)d+=a[e].FileName+"|"+a[e].FileSize+"|"+a[e].Hash+"\\\\";else d=a[0].FileName+"|"+a[0].FileSize+"|"+a[0].Hash+"\\\\";f=d,c.SendString(12,b,f)}catch(g){callback&&callback()}},playInit:function(){var _this=this;_this.globalParam.$playhead=$("#playhead");_this.globalParam.$progress=$("#progress");try{var lastTime=0;var vendors=["webkit","moz","ms","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(id){clearTimeout(id)}}catch(ex){}window.audioPlayerAnimloop=function(){if(!_this.globalParam.isAudioStop){_this.audioRender();if(_this.globalParam.songW>290){_this.render()}_this.globalParam.globalID=requestAnimationFrame(audioPlayerAnimloop)}};_this.bindUI()},bindUI:function(){var _this=this;if(typeof myAudio=="undefined"&&myAudio==null){myAudio=document.getElementById("myAudio")}_this.globalParam.myAudio=myAudio;myAudio.controls=false;myAudio.autobuffer=true;myAudio.preload="auto";myAudio.addEventListener("loadstart",function(e){});myAudio.addEventListener("durationchange",function(e){var t=Math.floor(myAudio.duration);_this.getDuration(t)});myAudio.addEventListener("loadedmetadata",function(e){if(myAudio.duration){var t=Math.floor(myAudio.duration);_this.getDuration(t)}});myAudio.addEventListener("loadeddata",function(e){});myAudio.addEventListener("progress",function(e){});myAudio.addEventListener("canplay",function(e){if(!_this.globalParam.isFirstPlay){if(myAudio.paused){_this.toggleSound()}}});myAudio.addEventListener("canplaythrough",function(e){});myAudio.addEventListener("abort",function(e){});myAudio.addEventListener("emptied",function(e){});myAudio.addEventListener("ended",function(e){if(_this.globalParam.wordArrHTML){_this.globalParam.ind=-2;_this.globalParam.wordArrHTML.removeClass("playOver");_this.globalParam.wordArrHTML=null}var toggle=$("#toggle");toggle.addClass("icon icon-playbar-play");_this.globalParam.isAudioStop=true;_this.audioStop();if($("#mode").hasClass("icon-playbar-cycle")){if(_this.globalParam.songIndex==_this.globalParam.songLength-1){_this.globalParam.songIndex=0}else{_this.globalParam.songIndex++}}else if($("#mode").hasClass("icon-playbar-singlecycle")){playOver();playOpen()}else if($("#mode").hasClass("icon-playbar-randomcycle")){_this.globalParam.songIndex=Math.floor(_this.globalParam.songLength*Math.random())}_this.playSong(_this.globalParam.songIndex)});myAudio.addEventListener("error",function(e,f){var errorCode=myAudio.error.code;if(errorCode==2||errorCode==3){var unshare=dialog({width:200,height:50,title:"提示",skin:"playsong",content:['<div class="addsong clearfix" id="addsong">','<div class="contetText">该音频不支持网页播放请下载客户端播放</div>',"</div>"].join("")}).show();setTimeout(function(){unshare.close().remove()},3e3)}});myAudio.addEventListener("pause",function(){if($("#toggle").hasClass("icon-playbar-pause")){var toggle=document.getElementById("toggle");toggle.className="icon icon-playbar-play"}if(!_this.globalParam.isAudioStop){_this.audioStop()}});myAudio.addEventListener("play",function(){if($("#toggle").hasClass("icon-playbar-play")){var toggle=document.getElementById("toggle");toggle.className="icon icon-playbar-pause"}if(_this.globalParam.isAudioStop){_this.audioStart()}});myAudio.addEventListener("playing",function(e){});myAudio.addEventListener("ratechange",function(){});myAudio.addEventListener("seeked",function(){});myAudio.addEventListener("seeking",function(){});myAudio.addEventListener("stalled",function(){});myAudio.addEventListener("suspend",function(){});myAudio.addEventListener("timeupdate",function(){});myAudio.addEventListener("volumechange",function(){});myAudio.addEventListener("waiting",function(){});$("#toggle").off("click").on("click",function(){if(_this.globalParam.isFirstPlay){_this.globalParam.isFirstPlay=false}_this.toggleSound()});$("#prev").off("click").on("click",function(){_this.globalParam.songLength>0?_this.playPrevSong():""});$("#next").off("click").on("click",function(){_this.globalParam.songLength>0?_this.playNextSong():""});$("#bar").off("click").on("click",function(e){if(_this.globalParam.isAudioStop){return}if(e.target!=document.getElementById("playhead")){var pre=e.offsetX/$("#progress_middle").width();pre=pre>1?1:pre;var msec=myAudio.duration*pre;_this.setPositioningPlay(msec)}});var $playhead=$("#playhead"),$progress=$("#progress"),$drag_playhead=$("#drag_playhead");$playhead.mousedown(function(e){e.stopPropagation();_this.globalParam.isPlayDrop=true;_this.globalParam.beginClientX=e.clientX;var str=$playhead.css("margin-left");_this.globalParam.begingPlayHeadX=Number(str.replace("px",""))});$(document).on("mousemove",function(e){if(_this.globalParam.isPlayDrop){if(_this.globalParam.begingPlayHeadX+(e.clientX-_this.globalParam.beginClientX)<=0){$progress.css("width","0");$playhead.css("margin-left","0")}else if(_this.globalParam.begingPlayHeadX+(e.clientX-_this.globalParam.beginClientX)>=$drag_playhead.width()){$progress.css("width","100%");$playhead.css("margin-left","100%")}else{var pre=(_this.globalParam.begingPlayHeadX+(e.clientX-_this.globalParam.beginClientX))/$drag_playhead.width();pre=pre.toFixed(4);_this.setProgress(pre)}}});$(document).on("mouseup",function(e){if(_this.globalParam.isPlayDrop){_this.globalParam.isPlayDrop=false;if(_this.globalParam.begingPlayHeadX+(e.clientX-_this.globalParam.beginClientX)<=0){$progress.css("width","0");$playhead.css("margin-left","0");_this.setPositioningPlay(0)}else if(_this.globalParam.begingPlayHeadX+(e.clientX-_this.globalParam.beginClientX)>=$drag_playhead.width()){$progress.css("width","100%");$playhead.css("margin-left","100%");_this.setPositioningPlay(myAudio.duration)}else{var pre=(_this.globalParam.begingPlayHeadX+(e.clientX-_this.globalParam.beginClientX))/$drag_playhead.width();pre=pre.toFixed(4);_this.setProgress(pre);var msec=myAudio.duration*pre;_this.setPositioningPlay(msec)}}});var panelT=null,volume_panel=$("#volume_panel"),volume_icon=$("#volume_icon");$("#volume").mouseenter(function(){if(volume_icon.hasClass("disabled"))return;volume_panel.show()}).mouseleave(function(e){if(volume_icon.hasClass("disabled"))return;panelT=setTimeout(function(){volume_panel.hide()},300)}).on("click",function(){if(volume_icon.hasClass("icon-playbar-silence")){volume_icon.removeClass("icon-playbar-silence").addClass("icon-playbar-minvox");_this.setMute(false);if(_this.globalParam.volumeNum==0){_this.globalParam.volumeNum="0.6";_this.setVolumeProgress(1-_this.globalParam.volumeNum)}_this.setVolume(_this.globalParam.volumeNum)}else{volume_icon.removeClass("icon-playbar-minvox").addClass("icon-playbar-silence");_this.setMute(true)}});$("#volume_control").off("click").on("click",function(e){if(volume_icon.hasClass("disabled"))return;var _screenH=Math.floor($("body").height());if(e.target!=document.getElementById("volumehead")){var pre=(e.clientY-(_screenH-175))/80;pre=pre>1?1:pre;_this.setVolumeProgress(pre);var vol=1-pre;_this.setVolume(vol)}});$("#volumehead").off("mousedown").mousedown(function(e){if(volume_icon.hasClass("disabled"))return;_this.globalParam.isVolumeDrop=true;_this.globalParam.beginClientY=e.clientY;var str=$("#volumehead").css("top");_this.globalParam.begingVolumeHeadY=Number(str.replace("px",""))});volume_panel.mouseenter(function(){$(this).show();clearTimeout(panelT)}).mouseleave(function(e){$(this).hide()}).mousemove(function(e){if(volume_icon.hasClass("disabled"))return;if(_this.globalParam.isVolumeDrop){if(_this.globalParam.begingVolumeHeadY+(e.clientY-_this.globalParam.beginClientY)<=0){$("#volume_progress").css("top","0");$("#volumehead").css("top","0");_this.setVolume(1)}else if(_this.globalParam.begingVolumeHeadY+(e.clientY-_this.globalParam.beginClientY)>=80){$("#volume_progress").css("top","83px");$("#volumehead").css("top","80px");_this.setVolume(0)}else{var pre=(_this.globalParam.begingVolumeHeadY+(e.clientY-_this.globalParam.beginClientY))/80;pre=pre.toFixed(4);_this.setVolumeProgress(pre);var vol=1-pre;_this.setVolume(vol)}}}).mouseup(function(e){if(volume_icon.hasClass("disabled"))return;if(_this.globalParam.isVolumeDrop){_this.globalParam.isVolumeDrop=false;if(_this.globalParam.begingVolumeHeadY+(e.clientY-_this.globalParam.beginClientY)<=0){$("#volume_progress").css("top","0");$("#volumehead").css("top","0");_this.setVolume(1)}else if(_this.globalParam.begingVolumeHeadY+(e.clientY-_this.globalParam.beginClientY)>=80){$("#volume_progress").css("top","83px");$("#volumehead").css("top","80px");_this.setVolume(0)}else{var pre=(_this.globalParam.begingVolumeHeadY+(e.clientY-_this.globalParam.beginClientY))/80;pre=pre.toFixed(4);_this.setVolumeProgress(pre);var vol=1-pre;_this.setVolume(vol)}}});$("#mode").off("click").on("click",function(e){e.stopPropagation();if($("#mode_panel").is(":hidden")){$("#mode_panel").show()}else{$("#mode_panel").hide()}});$("#pb_share").off("click").on("click",function(){var currentHash=_this.getPlayList()[_this.globalParam.songIndex]["Hash"],currentAlbumId=_this.getPlayList()[_this.globalParam.songIndex]["album_id"];var currentDom=$("#musicbox .active"),listSongName=currentDom.find(".musiclist-songname-txt").text().trim(),listSingerName=currentDom.find(".musiclist-artist").text().trim();_this.getdatabyhash({Hash:currentHash,album_id:currentAlbumId,callback:function(res){if(res["status"]!=0&&res["data"].length!=0){var shareData=$.extend(res["data"],{audio_name:listSingerName+"-"+listSongName});_this.share(shareData)}else{var unshare=dialog({width:200,height:50,title:"分享失败",skin:"unshare",content:"分享失败，稍后重试"}).show();setTimeout(function(){unshare.close().remove()},3e3)}}});var data=_this.commonConfig();data["action"]="click";data["b"]="分享btn";data["ivar4"]="ivar4";data["a"]=203;var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}});$("#pb_download").off("click").on("click",function(){_this.downloadError({type:"current"});var data=_this.commonConfig();data["action"]="click";data["b"]="下载btn";data["ivar4"]="播放条";data["a"]=200;var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}});$("#mode_panel li").off("click").on("click",function(e){e.stopPropagation();var clickIndex=$(this).index(),oldMode="",newMode="";if($("#mode").hasClass("icon-playbar-singlecycle")){oldMode="单曲循环"}else if($("#mode").hasClass("icon-playbar-cycle")){oldMode="列表循环"}else if($("#mode").hasClass("icon-playbar-randomcycle")){oldMode="随机播放"}$(this).find("a").addClass("mode-selected");$(this).siblings("li").find("a").removeClass("mode-selected");$(this).find(".icon").addClass("active");$(this).siblings("li").find(".icon").removeClass("active");if(clickIndex==1){$("#mode").attr("class","icon icon-playbar-singlecycle");newMode="单曲循环"}else if(clickIndex==0){$("#mode").attr("class","icon icon-playbar-cycle");newMode="列表循环"}else if(clickIndex==2){$("#mode").attr("class","icon icon-playbar-randomcycle");newMode="随机播放"}var data=_this.commonConfig();data["action"]="click";data["b"]="播放条-切换播放模式";data["ivar4"]=oldMode;data["ivar5"]=newMode;data["a"]=205;var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}$("#mode_panel").hide()});$("#showHide_playbar").off("click").click(function(e){if($(this).hasClass("show-playbar-btn")){$(this).attr("class","icon hide-playbar-btn");$("#audioModule").animate({bottom:"-80px"})}else{$(this).attr("class","icon show-playbar-btn");$("#audioModule").animate({bottom:"0px"})}});$("#list").off("click").on("click",function(e){e.stopPropagation();if(!_this.globalParam.showPlayFlag){_this.showPlaylist(true)}else{_this.showPlaylist(false)}});var filterEle="#list,#toggle,#mode_panel,#prev,#next,#volume_icon,#mode,#pb_download,#playhead,#mod-playlist";$(filterEle).on("mousedown",function(e){e.stopPropagation()});$(".songDetail .singerName").off("click").on("click","a",function(e){e.preventDefault();if($(this).length!=0){window.open($(this).attr("href"));var data=_this.commonConfig();data["action"]="click";data["b"]="歌词-歌手名txt";data["a"]=206;var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}}});$(".songDetail .albumName").off("click").on("click",function(e){e.preventDefault();if($(this).find("a").length!=0){var data=_this.commonConfig();data["action"]="click";data["b"]="歌词-专辑名txt";data["a"]=207;var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}window.open($(this).find("a").attr("href"))}});$(".btnMv").off("click").on("click",function(e){e.preventDefault();var data=_this.commonConfig();data["action"]="click";data["b"]="歌词-歌名右侧mvbtn";data["a"]=208;var Loaded=[30032,data];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}window.open(this.href)})},lyricsPlay:function(msec){var _this=this;var _len=_this.globalParam.wordArrLen;var _arr=_this.globalParam.wordArr;var i=0,_t=-1;for(i=0;i<_len;i++){if(_arr[i]<=msec){_t=i}else{break}}_arr=null;if(_t!=_this.globalParam.ind&&_this.globalParam.wordArrHTML){_this.globalParam.ind=_t;var tempObj=$(".songWordContent .jspPane p");var _end=0;if(_t==-1){$(".playOver").removeClass("playOver");_end=0}else{tempObj.each(function(ind){if(ind==_t){$(this).addClass("playOver")}else{if($(this).hasClass("playOver")){$(this).removeClass("playOver")}}});if(_t<=2){_end=0}else{_end=102-_t*34}var lyricsOverflowHeight=_this.globalParam.lyricsOverflowheight;var lyricsHeight=_this.globalParam.lyricsheight;if(Math.abs(_end)+lyricsOverflowHeight>lyricsHeight){_end=0-lyricsHeight+lyricsOverflowHeight}}try{var _wordArrObj=$(".songWordContent .jspPane");var str=_wordArrObj.css("top");var _top=Number(str.replace("px",""));_wordArrObj.animate({top:_end})}catch(ex){}}},playOnStart:function(){var _this=this;if(!_this.globalParam.isAudioStop){_this.stop()}var songName=$(".controls-songName");var songNameTemp=$("#songNameTemp");_this.globalParam.songW=Math.floor(songNameTemp.width());var str="";if(290>=_this.globalParam.songW){str+='<span class="songName" id="songName">'+_this.globalParam.songName+"</span>";songName.html(str)}else{str+='<span class="songName" id="songName">'+_this.globalParam.songName+"</span>";str+='<span class="songName" id="songName2">'+_this.globalParam.songName+"</span>";if(songName.html(str)){_this.globalParam.songNameEle1=$("#songName");_this.globalParam.songNameEle2=$("#songName2")}_this.globalParam.songNameEle1Left=0;setTimeout(function(){_this.globalParam.songNameEle2Left=_this.globalParam.songW+30;_this.globalParam.songNameEle2[0].style.marginLeft=_this.globalParam.songNameEle2Left+"px";if(_this.globalParam.isAudioStop){_this.start()}},500)}var vol=$.jStorage.get("kVolume");if(vol!=null&&typeof vol!="undefined"){_this.globalParam.volumeNum=vol;if(vol==0){_this.setMute(true);_this.setVolume(vol)}else{_this.setVolumeProgress(1-vol);_this.setVolume(vol)}}else{_this.setVolumeProgress(.4);_this.setVolume(.6)}},toggleSound:function(){var _this=this;var myAudio=document.getElementById("myAudio");if(myAudio==null||myAudio.src==""||myAudio.src=="http://www.kugou.com/song/"){return}var toggle=document.getElementById("toggle");if(myAudio.paused){myAudio.play();toggle.className="icon icon-playbar-pause";this.audioStart()}else{myAudio.pause();toggle.className="icon icon-playbar-play";this.audioStop()}},playPrevSong:function(){var _this=this;if($("#mode").hasClass("icon-playbar-randomcycle")){_this.globalParam.songIndex=Math.floor(_this.globalParam.songLength*Math.random())}else{if(this.globalParam.songIndex==0){this.globalParam.songIndex=this.globalParam.songLength}_this.globalParam.songIndex--}_this.playSong(this.globalParam.songIndex)},playNextSong:function(){var _this=this;if($("#mode").hasClass("icon-playbar-randomcycle")){_this.globalParam.songIndex=Math.floor(_this.globalParam.songLength*Math.random())}else{_this.globalParam.songIndex++;_this.globalParam.songIndex=this.globalParam.songIndex%this.globalParam.songLength}_this.playSong(this.globalParam.songIndex)},playError:function(){this.setStatus()},playStop:function(){this.toggleSound()},setStatus:function(){if(!this.globalParam.isStop){this.stop()}var toggle=document.getElementById("toggle");toggle.className="icon icon-playbar-play";this.globalParam.songW=0;this.globalParam.songName="";$("#playhead").hide();$("#progress_bar").hide();var songName=$(".controls-songName");songName.attr("title","");songName.html('<span class="songName" id="songName">酷狗音乐</span>');$(".change-time,.all-time").text("00:00");this.setProgress(0)},audioStart:function(){var myAudio=document.getElementById("myAudio");if(myAudio==null||myAudio.src==""||myAudio.src=="http://www.kugou.com/song/"){return}$("#playhead").show();$("#progress_bar").show();myAudio.play();this.globalParam.isAudioStop=false;this.globalParam.globalID=requestAnimationFrame(audioPlayerAnimloop)},audioStop:function(){var myAudio=document.getElementById("myAudio");if(myAudio==null||myAudio.src==""||myAudio.src=="http://www.kugou.com/song/"){return}myAudio.pause();this.globalParam.isAudioStop=true;cancelAnimationFrame(this.globalParam.globalID)},audioRender:function(){var myAudio=this.globalParam.myAudio;if(myAudio.readyState>0){if(!this.globalParam.isPlayDrop){var pre=myAudio.currentTime/myAudio.duration;pre=pre.toFixed(4);JSPositioningPlay(pre,Math.floor(myAudio.currentTime*1e3))}}},start:function(){this.globalParam.isAudioStop=false;this.globalParam.globalID=requestAnimationFrame(audioPlayerAnimloop)},stop:function(){this.globalParam.isAudioStop=true;cancelAnimationFrame(this.globalParam.globalID)},render:function(){var _this=this;_this.globalParam.doubEx++;if(_this.globalParam.doubEx%2==1)return;var sn1=_this.globalParam.songNameEle1;var sn2=_this.globalParam.songNameEle2;if(_this.globalParam.songNameEle1Left<-this.globalParam.songW){_this.globalParam.songNameEle1Left=_this.globalParam.songNameEle2Left+this.globalParam.songW+30}else{_this.globalParam.songNameEle1Left--}sn1[0].style.marginLeft=_this.globalParam.songNameEle1Left+"px";if(_this.globalParam.songNameEle2Left<-this.globalParam.songW){_this.globalParam.songNameEle2Left=_this.globalParam.songNameEle1Left+this.globalParam.songW+30}else{_this.globalParam.songNameEle2Left--}sn2[0].style.marginLeft=_this.globalParam.songNameEle2Left+"px"},setPlayDuration:function(msec){var ms=utility.getMS(msec);$("#duration .change-time").text(ms)},getDuration:function(msec){var t=this;t.globalParam.songDuration=msec;var ms=utility.getMS(msec*1e3);t.globalParam.duration=ms;$("#duration .all-time").text(ms)},setProgress:function(pro){var _this=this;pro=pro*100;_this.globalParam.$progress.css("width",""+pro+"%");_this.globalParam.$playhead.css("margin-left",""+pro+"%")},setPositioningPlay:function(msec){var myAudio=this.globalParam.myAudio;myAudio.currentTime=msec},setMute:function(b){var myAudio=this.globalParam.myAudio;if(b){myAudio.muted=true;$.jStorage.set("kVolume",0);$("#volume_progress").css("top","83px");$("#volumehead").css("top","80px")}else{myAudio.muted=false;this.setVolumeProgress(1-this.globalParam.volumeNum);$.jStorage.set("kVolume",this.globalParam.volumeNum);this.setVolume}},setVolumeProgress:function(pro){var prog=Number(pro)*80;var head=Number(pro)*83;$("#volume_progress").css("top",""+prog+"px");$("#volumehead").css("top",""+head+"px")},setVolume:function(vol){var myAudio=this.globalParam.myAudio;myAudio.volume=vol;$.jStorage.set("kVolume",vol);var t=this;if(vol>0){myAudio.muted=false;t.globalParam.volumeNum=vol;if(vol>.33){t.globalParam.volumeMode="icon icon-playbar-maxvox";$("#volume_icon").attr("class","icon icon-playbar-maxvox")}else{t.globalParam.volumeMode="icon icon-playbar-minvox";$("#volume_icon").attr("class","icon icon-playbar-minvox")}}else{$("#volume_icon").attr("class","icon icon-playbar-silence")}},setVolumeInteraction:function(hover){hover?$("#volume_icon").removeClass("disabled"):$("#volume_icon").addClass("disabled")},shared:null,downloadd:null,hashQueryShortUrl:function(option,callback){var _this=this;var filename=option.audio_name,hash=option.hash,album_id=option.album_id||0,md5Str=Md5.md5(hash+"kgclientshare"),from=option.chl=="weixin"?"webCode":"";var dataObj={cmid:1,filename:filename,hash:hash,album_id:album_id,is_short:1,md5:md5Str,chl:option.chl||"weixin",codes:1,from:from};$.ajax({type:"get",url:"http://t.service.kugou.com/app/",timeout:5e3,dataType:"jsonp",jsonp:"callback",data:dataObj,success:function(res){if(res){if(res.status){$(".qrcode").find("img").attr("src",res.codes_url);callback&&callback(res);
}else if(res.err_code==31001){setTimeout(function(){_this.shareIsCanClick=true},1e3);$(".qrcode").find("img").attr("src","http://www.kugou.com/yy/static/images/share_false.jpg");callback&&callback("")}}},error:function(xhr,type){callback&&callback("")}})},share:function(data){var _this=this,shareTitle=data["author_name"]+"-"+data["song_name"],shareIntro="我在酷狗常听的《"+shareTitle+"》，你也来听听吧！（来自 web 酷狗音乐）",sharePic="http://www.kugou.com/yy/static/images/share-cover.png";if(_this.shared){return}_this.shared=dialog({title:"分享歌曲",skin:"share_popup",fixed:true,content:["<div id='share_list'>"," <dl>","<dt class='share_weixin'></dt>","<dd class='qrcode'><img src='' /></dd>","<dd>微信</dd>","</dl>","<dl>","<dt class='share_friend'></dt>","<dd>QQ好友</dd>","</dl>","<dl>","<dt class='share_qzone'></dt>","<dd>QQ空间</dd>","</dl>","<dl>","<dt class='share_weibo'></dt>","<dd>新浪微博</dd>","</dl>","</div>"].join(""),onshow:function(){$(".ui-dialog").mousedown(function(){if($("#mod-playlist").css("bottom")=="80px"){_this.showPlaylist(true)}return false});data["chl"]="weixin";_this.hashQueryShortUrl(data,function(res){var shareShortUrl=res.data;$(".share_weixin").mouseover(function(){$(".qrcode").show()}).mouseout(function(){$(".qrcode").hide()});if(shareShortUrl==""||res.err_code==31001){_this.upSupportShare("微信")}});$.ajax({type:"get",url:"http://www.kugou.com/root/getSongCover?hash="+data["hash"],timeout:3e3,cache:false,success:function(res){if(res["status"]==1&&$.isArray(res["data"])&&res["data"][0]&&res["data"][0]["sizable_cover"]!=""){sharePic=res["data"][0]["sizable_cover"].replace(/{size}/,135)}},error:function(xhr,type){}});$(".share_friend").on("click",function(){var newWin=window.open("");data["chl"]="qq";_this.hashQueryShortUrl(data,function(res){var shareShortUrl=res.data;if(shareShortUrl==""||res.err_code==31001){_this.upSupportShare("QQ")}else{newWin.location="http://connect.qq.com/widget/shareqq/index.html?url="+encodeURIComponent(shareShortUrl)+"&desc=&title="+encodeURIComponent(shareTitle)+"&summary="+encodeURIComponent(shareIntro)+"&pics="+sharePic+"&flash=&site=www.kugou.com"}});var collectdata=_this.commonConfig();collectdata["action"]="click";collectdata["b"]="分享弹窗-分享渠道btn";collectdata["ivar4"]="QQ好友";collectdata["ivar5"]=data["hash"];collectdata["ivar6"]=shareTitle;collectdata["a"]=204;var Loaded=[30032,collectdata];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}_this.shared.close().remove()});$(".share_qzone").on("click",function(){var newWin=window.open("");data["chl"]="qzone";_this.hashQueryShortUrl(data,function(res){var shareShortUrl=res.data;if(shareShortUrl==""||res.err_code==31001){_this.upSupportShare("QQ空间")}else{newWin.location="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+encodeURIComponent(shareShortUrl)+"&title="+shareTitle+"&pics="+sharePic+"&summary="+shareIntro}});var collectdata=_this.commonConfig();collectdata["action"]="click";collectdata["b"]="分享弹窗-分享渠道btn";collectdata["ivar4"]="QQ空间";collectdata["ivar5"]=data["hash"];collectdata["ivar6"]=shareTitle;collectdata["a"]=204;var Loaded=[30032,collectdata];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}_this.shared.close().remove()});$(".share_weibo").on("click",function(){var weiboShareIntro;weiboShareIntro=shareIntro.replace("#","%23");weiboShareIntro=weiboShareIntro.replace("（来自 PC 酷狗音乐）","（ 来自 @酷狗音乐 web版 ）");weiboShareIntro=encodeURIComponent(weiboShareIntro);var newWin=window.open("");data["chl"]="weibo";_this.hashQueryShortUrl(data,function(res){var shareShortUrl=res.data;if(shareShortUrl==""||res.err_code==31001){_this.upSupportShare("微博")}else{newWin.location="http://v.t.sina.com.cn/share/share.php?appkey=340086183&pic="+sharePic+"&url="+encodeURIComponent(shareShortUrl)+"&title="+weiboShareIntro}});var collectdata=_this.commonConfig();collectdata["action"]="click";collectdata["b"]="分享弹窗-分享渠道btn";collectdata["ivar4"]="微博";collectdata["ivar5"]=data["hash"];collectdata["ivar6"]=shareTitle;collectdata["a"]=204;var Loaded=[30032,collectdata];apmCollectData.push(Loaded);try{newLogCount()}catch(ex){}_this.shared.close().remove()})},onclose:function(){_this.shared=null}});_this.shared.show()},upSupportShare:function(msg){var unshare=dialog({width:200,height:50,title:"不支持分享",skin:"unshare",content:"该歌曲不支持"+msg+"分享"}).show();setTimeout(function(){unshare.close().remove()},2e3)}};$(document).ready(function(){common_header.init();play.init()});function playStart(hash){}function playOver(hash){if($(".jspPane p")){play.globalParam.ind=-2;$(".jspPane p").removeClass("playOver");var _wordArrObj=$(".jspPane");var str=_wordArrObj.css("top");var _top=Number(str.replace("px",""));_wordArrObj.animate({top:0+"px"})}}function playOpen(){try{var word=play.globalParam.word;var _wordArr=word.match(/\[(.*)\]/g);var _s,_t,_sum;play.globalParam.wordArr=[];play.globalParam.wordArrLen=_wordArr?_wordArr.length:0;for(var i=0;i<play.globalParam.wordArrLen;i++){_s=_wordArr[i];_t=_s.substr(1,2);_sum=Math.floor(_t)*60*1e3;_t=_s.substr(4,2);_sum+=Math.floor(_t)*1e3;_t=_s.substr(7,2);_sum+=Math.floor(_t)*10;play.globalParam.wordArr.push(_sum)}_wordArr=null;play.globalParam.wordArrHTML=$(".jspPane p")}catch(ex){}}function JSPositioningPlay(pro,msec){if(!play.globalParam.isPlayDrop){play.setProgress(Number(pro));play.setPlayDuration(Math.floor(msec));play.lyricsPlay(Math.floor(msec))}}$(window).unload(function(){$.jStorage.set("playFlag","false");$.jStorage.set("playdata",null)});